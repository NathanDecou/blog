<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>Machine - underpass - Chez M. Dec</title><link href=https://nathandecou.github.io/blog/cyber/writeup_htb/underpass/ rel=canonical><link href=https://nathandecou.github.io/blog/favicon.png rel=icon type=image/png><link href=https://nathandecou.github.io/blog/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://nathandecou.github.io/blog/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://nathandecou.github.io/blog/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://nathandecou.github.io/blog/syntax-theme-dark.css rel=stylesheet><script defer src=https://nathandecou.github.io/blog/closable.js></script><script defer src=https://nathandecou.github.io/blog/copy-button.js></script><script defer src=https://nathandecou.github.io/blog/fuse.js></script><script defer src=https://nathandecou.github.io/blog/search-fuse.js></script><script defer src=https://nathandecou.github.io/blog/theme-switcher.js></script><meta content="Chez M. Dec" property=og:site_name><meta content="Machine - underpass - Chez M. Dec" property=og:title><meta content=https://nathandecou.github.io/blog/cyber/writeup_htb/underpass/ property=og:url><meta property=og:description><meta content=https://nathandecou.github.io/blog/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://nathandecou.github.io/blog> <i class=icon></i>Chez M. Dec</a><li class=divider><li><a href=https://nathandecou.github.io/blog/osint/>OSINT</a><li><a href=https://nathandecou.github.io/blog/cyber/>Cybersecurite</a><li><a href=https://nathandecou.github.io/blog/dev/>Dev</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><h1>Machine - underpass</h1><h2 id=machine>Machine</h2><ul><li>URL : <a href=https://app.hackthebox.com/machines/UnderPass>Underpass</a><li>Difficulté : easy</ul><h2 id=enumeration-initiale>Enumération initiale</h2><p>Enumeration TCP via <code>nmap -sV &LTIP></code><pre class=z-code><code><span class="z-text z-plain">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-17 13:06 CET
</span><span class="z-text z-plain">Nmap scan report for underpass.htb (10.10.11.48)
</span><span class="z-text z-plain">Host is up (0.012s latency).
</span><span class="z-text z-plain">Not shown: 998 closed tcp ports (conn-refused)
</span><span class="z-text z-plain">PORT   STATE SERVICE VERSION
</span><span class="z-text z-plain">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
</span><span class="z-text z-plain">80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))
</span><span class="z-text z-plain">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></code></pre><p>Enumeration UDP via <code>nmap -sU &LTIP></code><pre class=z-code><code><span class="z-text z-plain">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-17 11:07 CET
</span><span class="z-text z-plain">Nmap scan report for underpass.htb (10.10.11.48)
</span><span class="z-text z-plain">Host is up (0.015s latency).
</span><span class="z-text z-plain">Not shown: 97 closed udp ports (port-unreach)
</span><span class="z-text z-plain">PORT     STATE         SERVICE
</span><span class="z-text z-plain">161/udp  open          snmp
</span><span class="z-text z-plain">1812/udp open|filtered radius
</span><span class="z-text z-plain">1813/udp open|filtered radacct
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Nmap done: 1 IP address (1 host up) scanned in 115.88 seconds
</span></code></pre><h2 id=port-80>Port 80</h2><p>En se rendant sur le port 80 de la machine via un navigateur web on tombe sur la page par défaut d’Apache2 pour Ubuntu.<h2 id=port-161>Port 161</h2><p>Le port 161 est en ecoute pour le service SNMP. On peut en tirer des informations via <code>snmp-check &LTIP></code><pre class=z-code><code><span class="z-text z-plain">snmp-check v1.9 - SNMP enumerator
</span><span class="z-text z-plain">Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Try to connect to 10.10.11.48:161 using SNMPv1 and community 'public'
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[*] System information:
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  Host IP address               : 10.10.11.48
</span><span class="z-text z-plain">  Hostname                      : UnDerPass.htb is the only daloradius server in the basin!
</span><span class="z-text z-plain">  Description                   : Linux underpass 5.15.0-126-generic #136-Ubuntu SMP Wed Nov 6 10:38:22 UTC 2024 x86_64
</span><span class="z-text z-plain">  Contact                       : steve@underpass.htb
</span><span class="z-text z-plain">  Location                      : Nevada, U.S.A. but not Vegas
</span><span class="z-text z-plain">  Uptime snmp                   : 04:54:08.70
</span><span class="z-text z-plain">  Uptime system                 : 04:53:58.28
</span><span class="z-text z-plain">  System date                   : 2025-1-20 08:55:30.0
</span></code></pre><p>La partie <code>hostname</code> nous donne l’information que ce serveur heberge <a href=https://www.daloradius.com/>daloradius</a>, un GUI web pour manager un serveur FreeRadius.<h2 id=enumeration-de-repertoire-sur-le-serveur-web>Enumeration de repertoire sur le serveur web</h2><p>On va essayer d’énumérer des potentiels repertoires qui pourraient être sur <code>http://&LTIP>/daloradius</code>.<p>On utilise <code>dirsearch -u http://&LTIP>/daloradius -r</code>.<p>On trouve notamment ces deux URLs qui sont deux pages de login :<ul><li>http://<ip>/daloradius/app/users/login.php <li>http://<ip>/daloradius/app/operators/login.php <h2 id=acces-au-dashboard-daloradius>Accès au dashboard daloradius</h2> <p>Sur la doc de daloradius, on trouve que le couple <code>login:password</code> par defaut est <code>administrator:radius</code></p> <p>En testant sur les deux URLs precedemment trouvée, ce couple fonctionne pour <code>/operators/login.php</code></p> <img class=no-hover src=dashboard_daloradius.jpg><h2 id=acces-au-serveur>Accès au serveur</h2> <p>Via le dashboard il est possible de lister les utilisateurs. Ceci nous donne aussi le hash de leur mot de passe.</p> <img class=no-hover src=list_users.jpg> <p>On peut alors essayer de trouver le mot de passe en clair de l’utilisateur. Via <a href=https://crackstation.net/>crackstation</a> par exemple.</p> <img class=no-hover src=hash_crack.jpg> <p>Le mot de passe de l’utilisateur <code>svcMosh</code> est <code>underwaterfriends</code>.</p> <p>Les machines Hackthebox utilisent souvent le même procédé : un mot de passe trouvé sera souvent le mot de passe du même utilisateur sur la machine.</p> <p>En testant de se connecter en SSH en tant que <code>svcMosh</code> sur la machine avec le mot de passe <code>underwaterfriends</code>, on n’echappe pas à la règle et la connnexion fonctionne. On récupère donc le flag <code>user</code>.</p> <img class=no-hover src=logged.jpg><h2 id=flag-root>Flag root</h2> <h3 id=listing-sudo>Listing sudo</h3> <p>En tant que <code>svcMosh</code> on lance <code>sudo -l</code> pour voir à quoi l’on a accès. On voit que l’on peut lancer <code>/usr/bin/mosh-server</code> sans mot de passe en tant que root.</p> <pre class=z-code><code><span class="z-text z-plain">svcMosh@underpass:~$ sudo -l
</span><span class="z-text z-plain">Matching Defaults entries for svcMosh on localhost:
</span><span class="z-text z-plain">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">User svcMosh may run the following commands on localhost:
</span><span class="z-text z-plain">    (ALL) NOPASSWD: /usr/bin/mosh-server
</span></code></pre> <h3 id=analyse-du-fichier-usr-bin-mosh-server>Analyse du fichier <code>/usr/bin/mosh-server</code></h3> <p>Il s’agit d’un binaire lié à <code>mosh</code>, un outil permettant de remplacer les shell interactifs SSH.</p> <p>En regardant la documentation on voit que <code>mosh-server</code> permet de lancer un serveur mosh auquel un client mosh pourra se connecter. En lançant <code>sudo mosh-server</code>, on lance donc un serveur mosh en tant que root.</p> <p>Une fois ce serveur lancer, il nous suffit de faire <code>MOSH_KEY='&LTKEY>' mosh-client &LTIP> &LTPORT></code> pour se connecter au serveur et etre root ! Les valeurs de <code>&LTPORT></code> et de <code>&LTKEY></code> sont données par le retour de la commande <code>sudo mosh-server</code>.</p> <img class=no-hover src=root_logged.jpg> <p>And voila, nous sommes <code>root</code> sur cette machine.</p> <span class=hidden id=copy-code-text>Copy Code</span> <span class=hidden id=search-index>https://nathandecou.github.io/blog/search_index.en.json</span> <span class=hidden id=more-matches-text>$MATCHES more matches</span> <footer id=site-footer><nav><ul><li><a href=https://nathandecou.github.io/blog/osint/>OSINT</a><li><a href=https://nathandecou.github.io/blog/cyber/>Cybersecurite</a><li><a href=https://nathandecou.github.io/blog/dev/>Dev</a></ul></nav><p>© Chez M. Dec, 2025<p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small></footer> 