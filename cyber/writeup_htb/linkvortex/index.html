<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>Machine - linkvortex - Chez M. Dec</title><link href=https://nathandecou.github.io/blog/cyber/writeup_htb/linkvortex/ rel=canonical><link href=https://nathandecou.github.io/blog/favicon.png rel=icon type=image/png><link href=https://nathandecou.github.io/blog/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://nathandecou.github.io/blog/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://nathandecou.github.io/blog/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://nathandecou.github.io/blog/syntax-theme-dark.css rel=stylesheet><script defer src=https://nathandecou.github.io/blog/closable.js></script><script defer src=https://nathandecou.github.io/blog/copy-button.js></script><script defer src=https://nathandecou.github.io/blog/fuse.js></script><script defer src=https://nathandecou.github.io/blog/search-fuse.js></script><script defer src=https://nathandecou.github.io/blog/theme-switcher.js></script><meta content="Chez M. Dec" property=og:site_name><meta content="Machine - linkvortex - Chez M. Dec" property=og:title><meta content=https://nathandecou.github.io/blog/cyber/writeup_htb/linkvortex/ property=og:url><meta property=og:description><meta content=https://nathandecou.github.io/blog/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://nathandecou.github.io/blog> <i class=icon></i>Chez M. Dec</a><li class=divider><li><a href=https://nathandecou.github.io/blog/osint/>OSINT</a><li><a href=https://nathandecou.github.io/blog/cyber/>Cybersecurite</a><li><a href=https://nathandecou.github.io/blog/dev/>Dev</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><h1>Machine - linkvortex</h1><h2 id=machine>Machine</h2><ul><li>URL : <a href=https://app.hackthebox.com/machines/linkvortex>Linkvortex</a><li>Difficulté : easy</ul><h2 id=enumeration>Enumération</h2><p>On enumère les ports TCP ouverts avec <code>nmap -sV &LTIP></code>.<pre class=z-code><code><span class="z-text z-plain">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-21 09:39 CET
</span><span class="z-text z-plain">Nmap scan report for linkvortex.htb (10.10.11.47)
</span><span class="z-text z-plain">Host is up (0.016s latency).
</span><span class="z-text z-plain">Not shown: 998 closed tcp ports (reset)
</span><span class="z-text z-plain">PORT   STATE SERVICE VERSION
</span><span class="z-text z-plain">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
</span><span class="z-text z-plain">80/tcp open  http    Apache httpd
</span><span class="z-text z-plain">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class="z-text z-plain">Nmap done: 1 IP address (1 host up) scanned in 9.00 seconds
</span></code></pre><p>Il ya deux ports ouverts, le 80 avec un serveur web et le 22 en écoute pour une connexion SSH.<h2 id=port-80>Port 80</h2><h3 id=page-d-accueil>Page d’accueil</h3><p>En accedant à <code>&LTIP>:80</code> on est redirigé vers <code>http://linkvortex.htb</code>. Un blog est hebergé sur cette URL. En explorant rapidement on ne voit rien qui semble interessant.</p><img class=no-hover src=homepage.jpg><h3 id=robots-txt>robots.txt</h3><p>En allant sur <code>http://linkvortex.htb/robots.txt</code>, on recupère le fichier robots.txt du site.<pre class=z-code><code><span class="z-text z-plain">User-agent: *
</span><span class="z-text z-plain">Sitemap: http://linkvortex.htb/sitemap.xml
</span><span class="z-text z-plain">Disallow: /ghost/
</span><span class="z-text z-plain">Disallow: /p/
</span><span class="z-text z-plain">Disallow: /email/
</span><span class="z-text z-plain">Disallow: /r/
</span></code></pre><p>On y voit des URLs qui peuvent s’averer interessantes. Notamment l’URL <code>/ghost</code>, qui renvoie vers la page de login pour administrer le CMS (<a href=https://ghost.org>ghost</a>)</p><img class=no-hover src=login_page.jpg><h2 id=retour-a-de-l-enumeration>Retour à de l’énumération</h2><p>Après avoir tenté plusieurs couple login/password sans succès, on retourne enumérer pour voir si on a rien oublié.<h3 id=fuzz-de-vhost>Fuzz de vhost</h3><p>On tente de voir si quelque chose d’autre est hebergé par ce serveur web. Pour ça on va tenter de remplacer le champ <code>Host</code> dans la requete http et voir ce qui répond. On automatise cette tache avec <code>gobuster</code>.<pre class=z-code><code><span class="z-text z-plain">└─ $ gobuster vhost -w vhost_fuzz.txt --url 10.10.11.47 --domain linkvortex.htb --append-domain
</span><span class="z-text z-plain">===============================================================
</span><span class="z-text z-plain">Gobuster v3.6
</span><span class="z-text z-plain">by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
</span><span class="z-text z-plain">===============================================================
</span><span class="z-text z-plain">[+] Url:             http://10.10.11.47
</span><span class="z-text z-plain">[+] Method:          GET
</span><span class="z-text z-plain">[+] Threads:         10
</span><span class="z-text z-plain">[+] Wordlist:        vhost_fuzz.txt
</span><span class="z-text z-plain">[+] User Agent:      gobuster/3.6
</span><span class="z-text z-plain">[+] Timeout:         10s
</span><span class="z-text z-plain">[+] Append Domain:   true
</span><span class="z-text z-plain">===============================================================
</span><span class="z-text z-plain">Starting gobuster in VHOST enumeration mode
</span><span class="z-text z-plain">===============================================================
</span><span class="z-text z-plain">Found: dev.linkvortex.htb Status: 200 [Size: 2538]
</span><span class="z-text z-plain">Progress: 153 / 154 (99.35%)
</span><span class="z-text z-plain">===============================================================
</span><span class="z-text z-plain">Finished
</span><span class="z-text z-plain">===============================================================
</span></code></pre><p>On voit qu’on a une réponse pour <code>dev.linkvortex.htb</code>.<h2 id=dev-linkvortex-htb>dev.linkvortex.htb</h2><p>Cette page ne semble rien donner. Juste une image nous disant que le site arrive bientôt.</p><img class=no-hover src=dev_linkvortex.jpg><p>On lance dans le doute une recherche de repertoire avec <code>dirsearch</code>. On trouve alors un dossier <code>.git</code> accessible.</p><img class=no-hover src=found_git.jpg><h3 id=exploration-du-depot-git>Exploration du depot git</h3><p>On télécharge le dossier (<code>wget --no-parent -r http://dev.linkvortex.htb/.git</code>) et on restaure le depot (<code>git checkout .</code>). Voici l’architecture du dépot.<pre class=z-code><code><span class="z-text z-plain">└─ $ tree -L 1
</span><span class="z-text z-plain">.
</span><span class="z-text z-plain">├── apps
</span><span class="z-text z-plain">├── ghost
</span><span class="z-text z-plain">├── LICENSE
</span><span class="z-text z-plain">├── nx.json
</span><span class="z-text z-plain">├── package.json
</span><span class="z-text z-plain">├── PRIVACY.md
</span><span class="z-text z-plain">├── README.md
</span><span class="z-text z-plain">├── SECURITY.md
</span><span class="z-text z-plain">└── yarn.lock
</span></code></pre><p>C’est un fork du depot git de ghost. En faisant <code>git status</code> on voit que 2 fichiers ont été modifiés. Un a été ajouté et l’autre modifié.<pre class=z-code><code><span class="z-text z-plain">└─ $ git status
</span><span class="z-text z-plain">Actuellement sur aucune branche.
</span><span class="z-text z-plain">Modifications qui seront validées :
</span><span class="z-text z-plain">  (utilisez "git restore --staged &LTfichier>..." pour désindexer)
</span><span class="z-text z-plain">        nouveau fichier : Dockerfile.ghost
</span><span class="z-text z-plain">        modifié :         ghost/core/test/regression/api/admin/authentication.test.js
</span></code></pre><p>Si on regarde de plus près ce qui a été modifié, on voit que dans le fichier <code>authentication.test.js</code>, la chaine <code>thisissupersafe</code> est devenue <code>OctopiFociPilfer45</code>.<pre class=z-code><code><span class="z-text z-plain">└─ $ git diff --cached ghost/
</span><span class="z-text z-plain">diff --git a/ghost/core/test/regression/api/admin/authentication.test.js b/ghost/core/test/regression/api/admin/authentication.test.js
</span><span class="z-text z-plain">index 2735588..e654b0e 100644
</span><span class="z-text z-plain">--- a/ghost/core/test/regression/api/admin/authentication.test.js
</span><span class="z-text z-plain">+++ b/ghost/core/test/regression/api/admin/authentication.test.js
</span><span class="z-text z-plain">@@ -53,7 +53,7 @@ describe('Authentication API', function () {
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">         it('complete setup', async function () {
</span><span class="z-text z-plain">             const email = 'test@example.com';
</span><span class="z-text z-plain">-            const password = 'thisissupersafe';
</span><span class="z-text z-plain">+            const password = 'OctopiFociPilfer45';  &LT--- mot de passe changé
</span></code></pre><p>Si on essaie d’utiliser ce mot de passe en combinaison avec le mail <code>admin@linkvortex.htb</code>, on arrive à se connecter à l’interface.</p><img class=no-hover src=admin_page.jpg><h2 id=acces-au-serveur>Accès au serveur</h2><p>En regardant le code source des pages sur le blog on peut y voir <code>&LTmeta name="generator" content="Ghost 5.58"></code>. Nous indiquant donc que la version utilisée de ghost est la <code>5.58</code>.<p>Cette version est vulnérable à la <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-40028>CVE 2023-40028</a>. Cette vulnérabilité permet à un utilisateur authentifié de lire des fichiers sur le système (en uploadant des images qui sont en fait des liens symboliques vers ces fichiers).<p>Plusieurs POC existent pour exploiter cette vulnérabilité, j’ai utilisé celui ci : <a href=https://github.com/0xyassine/CVE-2023-40028>POC CVE 2023-40028 - 0xyassine</a><p>Dans le dépot git que l’on a récupéré se trouve le fichier <code>Dockerfile.ghost</code>. Une des directives présentes est <code>COPY config.production.json /var/lib/ghost/config.production.json</code>.<p>Ce fichier (<code>/var/lib/ghost/config.production.json</code>) semble être une bonne cible pour notre exploitation de la CVE.<p>En voici le contenu (tronqué pour faciliter la lecture):<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>url<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>http://localhost:2368<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>server<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>port<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">2368</span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>host<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>::<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">  <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json">  <span class="z-invalid z-illegal z-expected-mapping-key z-json"><</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">T</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">R</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">U</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">N</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">C</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">A</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">T</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">E</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">D</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>mail<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json">     </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>transport<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>SMTP<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">     </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>options<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json">      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>service<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Google<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>host<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>linkvortex.htb<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>port<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">587</span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>auth<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json">        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>user<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>bob@linkvortex.htb<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>   <span class="z-invalid z-illegal z-expected-mapping-key z-json"><</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span> <span class="z-invalid z-illegal z-expected-mapping-key z-json">l</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">o</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">g</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">i</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">n</span>
</span></span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>pass<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>fibber-talented-worth<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-invalid z-illegal z-expected-mapping-separator z-json"> </span><span class="z-invalid z-illegal z-expected-mapping-key z-json"><</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">-</span> <span class="z-invalid z-illegal z-expected-mapping-key z-json">p</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">a</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">s</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">s</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">w</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">o</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">r</span><span class="z-invalid z-illegal z-expected-mapping-key z-json">d</span>
</span></span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">        <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">      <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>On peut y voir un couple username/password (<code>bob@linkvortex.htb</code>/<code>fibber-talented-worth</code>).<p>En essayant ce couple en SSH, on accède à la machine.</p><img class=no-hover src=logged_user.jpg><h2 id=recuperation-du-flag-root>Recuperation du flag root</h2><p>En lançant <code>sudo -l</code>, on voit que l’utilisateur <code>bob</code> peut lancer en sudo la commande <code>/usr/bin/bash /opt/ghost/clean_symlink.sh *.jpg</code><p>Voici le contenu du script.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">QUAR_DIR</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/var/quarantined<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>z</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">CHECK_CONTENT</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">  <span class="z-variable z-other z-readwrite z-assignment z-shell">CHECK_CONTENT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">false</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">LINK</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-keyword z-operator z-logical z-shell">!</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-logical z-shell">=~</span> <span class="z-meta z-regexp z-shell"><span class="z-constant z-character z-escape z-shell">\.</span>jpg$</span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>! First argument must be a jpg file !<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-exit z-shell">exit</span></span><span class="z-meta z-function-call z-arguments z-shell"> 2</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> /usr/bin/test<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">  <span class="z-variable z-other z-readwrite z-assignment z-shell">LINK_NAME</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/basename</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-variable z-other z-readwrite z-assignment z-shell">LINK_TARGET</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/readlink</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK_TARGET</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Eq</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>(etc|root)<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>! Trying to read critical files, removing link [ <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span> ] !<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/unlink</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Link found [ <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span> ] , moving it to quarantine<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/mv</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">QUAR_DIR</span></span>/</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">CHECK_CONTENT</span></span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Content:<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/bin/cat</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">QUAR_DIR</span></span>/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LINK_NAME</span></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">></span>/dev/null</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">  <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><p>Ce script sert à deplacer des fichiers <code>jpg</code> qui sont en fait des liens symboliques vers un dossier de quarantaine. Voici les 2 caractéristiques importantes du script :<ul><li>Une variable d’environnement permet ou non de lire le contenu du fichier pointé.<li>Si le fichier pointé contient ‘root’ ou ‘etc’, le lien sera supprimé et aucune lecture du fichier ne sera possible</ul><p>Notre but est de lire le fichier <code>/root/root.txt</code> (fichier contenant le flag sur les machines HTB), il nous faut donc bypasser ce deuxième point.<p>Pour cela, il suffit de faire deux liens. Le premier qui pointera vers <code>/root/root.txt</code>, le second vers le premier. Et on utilisera le premier avec le script.</p><img class=no-hover src=proc_root.jpg><p>Nous avons donc réussi à lire le fichier <code>/root/root.txt</code>.</p><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://nathandecou.github.io/blog/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://nathandecou.github.io/blog/osint/>OSINT</a><li><a href=https://nathandecou.github.io/blog/cyber/>Cybersecurite</a><li><a href=https://nathandecou.github.io/blog/dev/>Dev</a></ul></nav><p>© Chez M. Dec, 2025<p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small></footer>